name: 'redshift'
version: '0.0.1'

source-paths: ["models"]
macro-paths: ["macros"]
test-paths: ["tests"]

models:
  redshift:
    base:
      materialized: ephemeral

    introspection:
      materialized: ephemeral

    views:
      materialized: view

    tables:
      redshift_query_mode_table:
        materialized: incremental
        sql_where: 'TRUE' # Advanced incremental model usage https://docs.getdbt.com/docs/configuring-models#section-advanced-incremental-model-usage
        unique_key: 'md5(q.query_id::varchar + q.started_at::varchar)'
        sort: 'started_at'
        dist: 'query_id'
        post-hook: "{{ redshift.unload_table(this.schema, this.table, 's3://mode-rs-spectrum-data-lake/redshift_query_mode_table', env_var('AWS_S3_IAM_ROLE'), delimiter='|', overwrite=True) }}" # UNLOAD to s3 after build
